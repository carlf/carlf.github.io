<!doctype html><html lang=en-us>
<head>
<title>Refactoring Terraform with tfmigrate // carlf.io</title>
<link rel="shortcut icon" href=/favicon.ico>
<meta charset=utf-8>
<meta name=generator content="Hugo 0.88.0">
<meta name=viewport content="width=device-width,initial-scale=1">
<meta name=author content="Carl Flippin">
<meta name=description content>
<link rel=stylesheet href=https://carlf.io/css/main.min.b339dd1708b02ecc412951daade2fa41b07a948fdd24a9b8963e6f9c52bc979a.css>
<meta name=twitter:card content="summary">
<meta name=twitter:title content="Refactoring Terraform with tfmigrate">
<meta name=twitter:description content="So you want to refactor your terraform You have some terraform. It was written in haste and you have many regrets. You would like to refactor but you worry about the state transition. If you move a resource under a different path it will not match and will require painful destroy / create cycles.
tfmigrate The solution is tfmigrate. It allows you to write clear migrations for your state and lets you test your migrations without worrying about clobbering your existing state.">
<meta property="og:title" content="Refactoring Terraform with tfmigrate">
<meta property="og:description" content="So you want to refactor your terraform You have some terraform. It was written in haste and you have many regrets. You would like to refactor but you worry about the state transition. If you move a resource under a different path it will not match and will require painful destroy / create cycles.
tfmigrate The solution is tfmigrate. It allows you to write clear migrations for your state and lets you test your migrations without worrying about clobbering your existing state.">
<meta property="og:type" content="article">
<meta property="og:url" content="https://carlf.io/posts/refactoring-terraform-with-tfmigrate/"><meta property="article:section" content="posts">
<meta property="article:published_time" content="2021-09-03T12:32:39-07:00">
<meta property="article:modified_time" content="2021-09-03T12:32:39-07:00">
</head>
<body>
<header class=app-header>
<a href=https://carlf.io><img class=app-header-avatar src=/avatar.png alt="Carl Flippin"></a>
<h1>carlf.io</h1>
<nav class=app-header-menu>
<a class=app-header-menu-item href=/>Home</a>
-
<a class=app-header-menu-item href=/index.xml>RSS</a>
-
<a class=app-header-menu-item href=/tags>Tags</a>
</nav>
<p>I'm just as confused as the rest of you</p>
<div class=app-header-social>
<a href=https://github.com/carlf target=_blank rel="noreferrer noopener"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-github"><title>My Github</title><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0020 4.77 5.07 5.07.0 0019.91 1S18.73.65 16 2.48a13.38 13.38.0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 005 4.77 5.44 5.44.0 003.5 8.55c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 009 18.13V22"/></svg>
</a>
<a href=https://keyoxide.org/hkp/50f1a8d452b5c094a656ce6aac084c5eec19856d target=_blank rel="noreferrer noopener"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-key"><title>My GPG Key</title><path d="M21 2l-2 2m-7.61 7.61a5.5 5.5.0 11-7.778 7.778 5.5 5.5.0 017.777-7.777zm0 0L15.5 7.5m0 0 3 3L22 7l-3-3m-3.5 3.5L19 4"/></svg>
</a>
</div>
</header>
<main class=app-container>
<article class=post>
<header class=post-header>
<h1 class=post-title>Refactoring Terraform with tfmigrate</h1>
<div class=post-meta>
<div><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-calendar"><title>calendar</title><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>
Sep 3, 2021
</div>
<div><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-clock"><title>clock</title><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>
1 min read
</div>
<div><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tag"><title>tag</title><path d="M20.59 13.41l-7.17 7.17a2 2 0 01-2.83.0L2 12V2h10l8.59 8.59a2 2 0 010 2.82z"/><line x1="7" y1="7" x2="7.01" y2="7"/></svg>
<a class=tag href=https://carlf.io/tags/terraform/>terraform</a>
</div>
</div>
</header>
<div class=post-content>
<h1 id=so-you-want-to-refactor-your-terraform>So you want to refactor your terraform</h1>
<p>You have some terraform. It was written in haste and you have many regrets. You
would like to refactor but you worry about the state transition. If you move a
resource under a different path it will not match and will require painful
destroy / create cycles.</p>
<h1 id=tfmigrate>tfmigrate</h1>
<p>The solution is <a href=https://github.com/minamijoyo/tfmigrate>tfmigrate</a>. It allows
you to write clear migrations for your state and lets you test your migrations
without worrying about clobbering your existing state.</p>
<p>Here is an example of a migration:</p>
<div class=highlight><pre tabindex=0 style=color:#d8dee9;background-color:#2e3440;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-hcl data-lang=hcl><span style=color:#81a1c1;font-weight:700>migration</span> <span style=color:#a3be8c>&#34;state&#34; &#34;test&#34;</span> {
    <span style=color:#81a1c1;font-weight:700>actions</span> <span style=color:#eceff4>[</span>
        <span style=color:#a3be8c>&#34;mv &#39;foo&#39; &#39;bar&#39;&#34;</span><span style=color:#eceff4>,</span>
        <span style=color:#a3be8c>&#34;mv &#39;baz&#39; &#39;quux&#39;&#34;</span>
    <span style=color:#eceff4>]</span>
}</code></pre></div>
</div>
<div class=post-footer>
</div>
</article>
</main>
</body>
</html>